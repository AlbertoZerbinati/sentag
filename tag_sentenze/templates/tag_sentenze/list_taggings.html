{% extends "users/layout.html" %}

{% block title %}
    Taggings
{% endblock %}

{% block nav %}
    <nav label="Page navigation">
        <ul class="pagination justify-content-center">
                <li class="page-item"><a class="page-link" href="/register/">Add User</a></li>
                <li class="page-item"><a class="page-link" href="{% url 'tag_sentenze:new-schema' %}">Add Schema</a></li>
                <li class="page-item"><a class="page-link" href="{% url 'tag_sentenze:multiple-schemas' %}">Add Schemas</a></li>
                <li class="page-item"><a class="page-link" href="{% url 'tag_sentenze:new-sentenza' %}">Add Judgment</a></li>
                <li class="page-item"><a class="page-link" href="{% url 'tag_sentenze:multiple-judgment' %}">Add Judgments</a></li>
                <li class="page-item"><a class="page-link" href="{% url 'users:home-judgment-schema' %}">Associate Judgments - Schemas</a></li>
                <li class="page-item"><a class="page-link" href="{% url 'users:home-permission' %}">Associate Judgments - Users</a></li>
                <li class="page-item"><a class="page-link" href="{% url 'users:agreement-page' %}">Agreement</a></li>
                <li class="page-item active"><a class="page-link" href="{% url 'tag_sentenze:list-taggings' %}">Download</a></li>
        </ul>
    </nav>
{% endblock %}

{% block content %}
<h2 class="title">Download tagged judgments</h2>
<table class="table table-striped table-hover">
    <thead>
        <tr>
            <th>Judgment</th>
            <th>Tagger</th>
            <th>Download Button</th>
        </tr>
    </thead>
    <tbody>
        {% for tagging in taggings %}
        <tr>
            <td>{{tagging.judgment}}</td>
            <td>{{tagging.profile}}</td>
            {% if tagging.completed %}
                <td><button class="btn btn-primary btn-small" onclick="downl({{tagging.id}})">DOWNLOAD xml</button> </td>
            {% else %}
                <td>Not yet completed</td> 
            {% endif %}
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}

{% block script %}
<script>
    function downl(id) {
        $.get( "/download/"+id, function(data) {
            console.log( typeof data ); // string
            console.log( data ); // HTML content of the jQuery.ajax page

            let filename = data['name'] + ".xml"
            let outputString = data['xml']

            let element = document.createElement("a");
            element.setAttribute(
                "href",
                "data:text/plain;charset=utf-8," + encodeURIComponent(outputString)
            );
            element.setAttribute("download", filename);

            element.style.display = "none";
            document.body.appendChild(element);
            element.click();
            document.body.removeChild(element);
        });
    }
</script>
{% endblock %}
